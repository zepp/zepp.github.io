<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
<head>
<!-- 2025-10-23 Чт 18:24 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Чем полезен TOTP для обычного человека</title>
<meta name="author" content="Павел Соколов" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="shared/article.css"/>
<script src="shared/bundle.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Чем полезен TOTP для обычного человека</h1>
<p>
<span class="timestamp-wrapper"><span class="timestamp">&lt;Пт 08 сен 2023&gt;</span></span>, обновлено <span class="timestamp-wrapper"><span class="timestamp">&lt;Вт 18 июн 2024&gt;</span></span><br />
</p>

<p>
В этой краткой статье я хочу рассказать, чем может быть полезен и удобен TOTP для обычного человека. Это не разбор стандарта с технической точки зрения и тут будет минимум терминов. Опираясь на ряд новостей и информацию из открытых источников, хотелось бы подсветить ряд очевидных проблем, которые возникают, если использовать устаревшие подходы.
</p>

<p>
TOTP (Time-based one-time password) это стандарт, который описывает алгоритм для генерации одноразовых кодов, используемых в двухфакторной аутентификации, далее 2FA (Two-factor authentication), для краткости. 2FA это знакомая большинству людей вещь, с которой они сталкиваются, например, при аутентификации в банковском приложении, когда необходимо вводить одноразовый код из SMS. Смысл 2FA в том, что кроме пароля появляется дополнительный фактор, а именно фактор владения, который заключается в том, что одноразовый код высылается на <i>ваш</i> сотовый номер. Даже если ваш пароль стал известен третьим лицам, они не смогут пройти аутентификацию, так как они не могут подтвердить фактор владения.
</p>

<p>
Доставка одноразовых кодов через SMS это небезопасный и ненадёжный способ, а ниже я рассмотрю почему.
</p>

<div id="outline-container-possesion" class="outline-2">
<h2 id="possesion"><a href="#possesion">Кому принадлежит сотовый номер</a></h2>
<div class="outline-text-2" id="text-possesion">
<p>
Исходя из определения фактора владения, стоит уточнить, а принадлежит ли сотовый номер абоненту на самом деле. Вот что пишут на Хабре в <a href="https://habr.com/ru/articles/667960/">статье</a> про то, кому принадлежит ваш сотовый номер:
</p>

<blockquote>
<p>
Номер телефона изначально принадлежит Российской Федерации, то есть государству, которое выделяет номера операторам связи, а те в свою очередь &#x2014; абонентам. Причем российские телефонные номера являются частью международной системы нумерации.
</p>
</blockquote>

<p>
Поскольку сотовый оператор может <i>изымать</i> абонентские номера, то конфликт с оператором может привести к полной потери доступа к некоторым сайтам или потребуется ощутимое количество времени, чтобы его восстановить. Придётся идти в офис или отделение банка с паспортом, и писать заявление на смену номера. Ситуация редкая, но тоже иногда случается.
</p>

<p>
Другая проблема заключается в том, что существуют мошеннические схемы, которые позволяют перевыпустить SIM-карту без вашего ведома, например, по поддельное доверенности. После чего, злоумышленники могут начать атаку на ваши аккаунты.
</p>
</div>
</div>

<div id="outline-container-security" class="outline-2">
<h2 id="security"><a href="#security">Безопасность и надёжность доставки</a></h2>
<div class="outline-text-2" id="text-security">
<p>
Стэк <a href="https://en.wikipedia.org/wiki/Signalling_System_No._7#Protocol_security_vulnerabilities">SS7</a> содержит уязвимости и это уже не раз было использовано для перехвата SMS:
</p>

<blockquote>
<p>
In May 2017, O2 Telefónica, a German mobile service provider, confirmed that the SS7 vulnerabilities had been exploited to bypass two-factor authentication to achieve unauthorized withdrawals from bank accounts. The perpetrators installed malware on compromised computers, allowing them to collect online banking account credentials and telephone numbers. They set up redirects for the victims' telephone numbers to telephone lines controlled by them. Confirmation calls and SMS text messages of two-factor authentication procedures were routed to telephone numbers controlled by the attackers. This enabled them to log into victims' online bank accounts and effect money transfers
</p>
</blockquote>

<p>
TOTP устроен таким образом, что код генерируется на стороне <i>клиента</i> и после передаётся на сервер для завершения аутентификации. Для генерации одноразовых кодов в TOTP используется секретный ключ, который хранится на устройстве клиента и сервере. Иными словами, код не надо предварительно пересылать клиенту, чтобы тот послал его обратно, как это происходит в случае доставки кодов по SMS. Исчезает дополнительный канал связи, реализованный через вышеупомянутый стэк SS7, на который можно проводить атаку.
</p>

<p>
Есть и другой момент: атака на этот дополнительный канал связи или часть системы, которая с ним взаимодействует, позволяет нарушить аутентификацию в целом. Вот <a href="https://www.rbc.ru/politics/08/09/2023/64fac0899a79479f119e88a6">пример</a> проблемы с получением SMS для голосования в Москве:
</p>

<blockquote>
<p>
Пользователи на официальной странице департамента информационных технологий Москвы во «ВКонтакте» пожаловались на проблему с доступом к электронному голосованию на сервисе московских госуслуг (mos.ru): им не приходит SMS-сообщение с кодом, который нужен для онлайн-участия в выборах мэра столицы. В том, что SMS не приходят, убедились корреспонденты РБК.
</p>

<p>
&#x2026;
</p>

<p>
Причиной задержки поступления СМС участникам ДЭГ стала атака на серверы компании «Интермобилити», отвечающей за доставку сообщений, заявил ТАСС ее совладелец Даниил Титаренко.
</p>
</blockquote>

<p>
Складывается впечатление, что была нарушена работа отдельной функции и доступ к порталу сохранился. Наверное, 2FA работает через отдельный сервис, но если бы это было не так, то сломалось бы всё сразу.
</p>
</div>
</div>

<div id="outline-container-delivery" class="outline-2">
<h2 id="delivery"><a href="#delivery">Проблемы с доставкой</a></h2>
<div class="outline-text-2" id="text-delivery">
<p>
Проблемы с доставкой могут возникнуть при неполадках в сотовой сети оператора или нахождение абонента вне зоны действия домашней сети. Вполне возможна ситуация, когда не доступен роуминг, но выход в интернет при этом есть.
</p>

<p>
Вот <a href="https://www.rbc.ru/technology_and_media/02/09/2023/64f202f89a794758fdd0d9b2">пример</a> ситуации, когда российские абоненты «большой четверки» остались без роуминга в Канаде:
</p>

<blockquote>
<p>
Канада ввела санкции против сотовых операторов МТС, «МегаФон», «Т2 РТК Холдинг» (оказывает услуги под брендом Tele2) и «ВымпелКом» (бренд «Билайн»), а также против ряда других компаний и физлиц в июле этого года. В пояснении говорилось, что эти телекоммуникационные компании связаны с российским военно-промышленным комплексом. Санкции запрещают совершать сделки с попавшими в список лицами и компаниями, а также участвовать в любой деятельности, связанной с любым их имуществом, предоставлять им финансовые или сопутствующие услуги &#x2026; абоненты смогут получать услуги связи, подключившись к Wi-Fi или купив сим-карты местных операторов, но без роуминга они не смогут получать СМС на российский номер &#x2014; например, для авторизации или подтверждения банковских транзакций.
</p>
</blockquote>

<p>
Естественно, если не пересылать одноразовые коды через сотовую сеть, то такой проблемы быть не может.
</p>
</div>
</div>

<div id="outline-container-conclusion" class="outline-2">
<h2 id="conclusion"><a href="#conclusion">Заключение</a></h2>
<div class="outline-text-2" id="text-conclusion">
<p>
Исходя из обозначенных выше проблем, стоит делать выбор в пользу TOTP, там где это доступно. Секретный ключ TOTP невозможно подделать, а только украсть вместе с устройством. Помимо этого, некоторые сайты требуют включения хоть какой-то 2FA и, пока это не сделано, они будут слать одноразовые коды вам на почту, что неудобно и небезопасно.
</p>

<p>
Чтобы начать пользоваться TOTP, необходимо установить на телефон <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2">Google Authenticator</a> или <a href="https://authy.com/">Authy</a>, что не займёт много времени. Для добавления нового ключа нужно просто отсканировать QR-код, который выводится на сайте при настройке. <b>Не забываем</b> при этом распечатать набор запасных одноразовых кодов, иначе будет трудно восстановить доступ к аккаунту, в случае потери или кражи устройства.
</p>

<p>
Где доступен TOTP:
</p>
<ul class="org-ul">
<li>Госуслуги,</li>
<li>Банк Санкт-Петербург,</li>
<li>аккаунт Microsoft,</li>
<li>большинство криптобирж.</li>
</ul>

<p>
Если интересны технические подробности, то можно почитать неплохую <a href="https://habr.com/ru/articles/534064/">статью</a> на Хабре про то, как устроен TOTP.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Павел Соколов</p><p class="timestamp">2025-10-23 Чт 18:24</p>
</div>
</body>
</html>
